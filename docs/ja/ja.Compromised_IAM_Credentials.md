# AWS アカウントの認証情報が侵害された場合のセキュリティプレイブック

## はじめに

お客様への継続的な取り組みの一環として、AWS はこれを提供しています
必要な手順を説明したセキュリティインシデント対応プレイブック
AWS 内の侵害された認証情報を検出して対応します
アカウント。 この文書の目的は、規範を提供することです
セキュリティイベントが疑われる場合に取るべき行動に関するガイダンスには
が行われました。

![Image](/images/nist_life_cycle.png)

*AWS Sのインシデント対応の側面*

## 準備

インシデント対応を迅速かつ効果的に実行するために
アクティビティでは、人材、プロセス、を準備することが重要です
組織内のテクノロジー。 [* AWS セキュリティインシデントを確認してください
応答
ガイド*] (https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/preparation.html),
そして、全員の準備を整えるために必要な措置を実施してください
3つのドメイン。

## AWS サポートに支援を依頼する方法

侵害の疑いがある場合はすぐにAWS に通知することが重要です
AWS Sアカウントまたは組織内の認証情報。 これが
AWS サポートを利用する手順：

### AWS Sサポートケースを開く

-AWS アカウントにログインします。

-これはセキュリティの影響を受けた最初のAWS アカウントです
イベント、AWS アカウントの所有権を検証します。

-注意：アカウントにアクセスできない場合は、[this] を使用してください
フォーム] (https://support.aws.amazon.com/#/contacts/aws-account-support/)
サポートリクエストを送信してください。

-「*サービス*」、「*サポートセンター*」、「*ケースを作成*」を選択します。

-問題の種類「*アカウントと請求」*を選択してください。

-影響を受けるサービスとカテゴリを選択してください：

-例:

-サービス:アカウント

-カテゴリー:セキュリティ

-重要度を選択してください:

-エンタープライズサポートまたはオンランプのお客様向け:*重大なビジネスリスク
質問*。

-ビジネスサポートのお客様：*ビジネスリスクに関する緊急の質問*。

-質問や問題を説明してください：

-あなたが抱えているセキュリティ問題の詳細な説明をしてください
経験、影響を受けるリソース、ビジネスへの影響。

-セキュリティイベントが最初に認識された時間。

-ここまでのイベントタイムラインのまとめ。

-収集したアーティファクト（スクリーンショット、ログファイル）。

-侵害されていると思われるIAM ユーザーまたはロールのARN。

-影響を受けるリソースとビジネスへの影響の説明。

-あなたの組織における関与のレベル（例：「このセキュリティ
イベントには、CEOと取締役会の知名度があります
ディレクター」)。

-オプション：ケースの連絡先を追加します。

-「*お問い合わせ*」を選択します。

-希望する連絡言語（空き状況により異なる場合があります）

-優先連絡方法：ウェブ、電話、またはチャット（推奨）

-オプション：追加のケース連絡先

<!---->

-*「送信」をクリック*

-**エスカレーション**: できるだけ早くAWS Sアカウントチームに連絡してください
可能なので、彼らは必要なリソースを投入し、次のようにエスカレートする可能性があります
必要な。

**注意：**「代替セキュリティ」を確認することは非常に重要です
「連絡先」は、AWS アカウントごとに定義されています。 詳細については、を参照してください
に [これ
記事] (https://aws.amazon.com/blogs/security/update-the-alternate-security-contact-across-your-aws-accounts-for-timely-security-notifications/)。

## 検出

あなたの中の侵害された認証情報を検出する方法は複数あります
AWS 環境。 リストされているのは、潜在的な指標を検出するいくつかの方法です
妥協（IoC）。 IoCの詳細なリストについては、[付録] を参照してください
A。] (#appendix-a-reviewing-logs) **注意**: それぞれの詳細を文書化してください
さらなる分析IoC 疑いがあります。

1。 アマゾンレビュー [GuardDuty]
調査結果] (https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html)。
以下の調査結果は、疑わしいまたは異常な活動に関するものです
IAM エンティティ別。 [調査結果を確認してください
詳細] (https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-iam.html),
そして、そのアクティビティが予想外の場合は、侵害されている可能性があります
資格情報。

1。 CredentialAccess:IAMUser/AnomalousBehavior

2。 DefenseEvasion:IAMUser/AnomalousBehavior

3。 Discovery:IAMUser/AnomalousBehavior

4。 Exfiltration:IAMUser/AnomalousBehavior

5。 Impact:IAMUser/AnomalousBehavior

6。 InitialAccess:IAMUser/AnomalousBehavior

7。 PenTest:IAMUser/KaliLinux

8。 PenTest:IAMUser/ParrotLinux

9。 PenTest:IAMUser/PentooLinux

10。 Persistence:IAMUser/AnomalousBehavior

11。 Policy:IAMUser/RootCredentialUsage

12。 PrivilegeEscalation:IAMUser/AnomalousBehavior

13。 Recon:IAMUser/MaliciousIPCaller

14。 Recon:IAMUser/MaliciousIPCaller.Custom

15。 Recon:IAMUser/TorIPCaller

16。 Stealth:IAMUser/CloudTrailLoggingDisabled

17。 Stealth:IAMUser/PasswordPolicyChange

18。 UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B

19。 UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

20。 UnauthorizedAccess:IAMUser/MaliciousIPCaller

21。 UnauthorizedAccess:IAMUser/MaliciousIPCaller.Custom

22。 UnauthorizedAccess:IAMUser/TorIPCaller

2。 アカウントの兆候である異常な急増がないか、AWS Billingを見直してください
次の手順に従うと、資格情報が危険にさらされます。

1。 AWS マネジメントコンソールにサインインして、[Billing] を開きます
コンソール] (https://console.aws.amazon.com/billing/)。

2。 「*Bills」*を選択すると、現在の請求の詳細が表示されます。

3。 「*支払い」*を選択すると、過去の支払い取引が表示されます。

4。 「*AWS コストと使用状況レポート」*を選択すると、壊れているレポートが表示されます
コストを削減してください。

3。 IAM コンソールにアクセスして、IAM 認証情報レポートをダウンロードし、
左側の「*アクセス」の下にある「*資格報告書」*を選択してください
レポート」* 次に、以下を確認してください。

1. 作成日を見て、IAM ユーザーの異常な作成を特定します
と最後に使用したパスワード/変更したパスワードの列。

2。 2つ以上のアクセスキーを持っているIAM ユーザーがいないか確認してください。

3。 持っているIAMユーザーがいないか確認してください
* AWS公開の認証情報ポリシー\ _DO\ _NOT\ _REMOVE* が添付されています。 もしそうなら、
アクセスキーをローテーションします。

4。 AWS アカウント内のIAM ロールを確認して、なじみのないものがないか確認してください
作成またはアクセスされたロール

1。 AWS Sコンソールで、「*サービス*」、「*IAM *」を選択し、
「*役割*」

2。 なじみのない「*ロール名*」を確認してください。

3。 ロール名をクリックして、リストされている詳細を確認してください。

1。 役割作成日

2。 ARN

3。 最後のアクティビティ

4。 添付されているIAM ポリシーを確認するには、「*権限*」をクリックしてください
その役割に。

5。 「*信頼関係*」をクリックすると、引き受けることができる団体が表示されます
役割。

6。 「*アクセスアドバイザー*」をクリックすると、これまで提供されてきたサービスが表示されます
ロールによるアクセスと「*最終アクセス日*」。

5。 AWS 内の認識されていない、または許可されていないリソースを検出してください
次のようなアカウント：

1。 AWS CLI で次のコマンドを実行してEC2インスタンスを起動します
ターミナル「*aws ec2記述インスタンス *」と検証してください
結果。 を使用して、各インスタンスの作成時間を探してください
*--クエリ '予約\ [\] .インスタンス\ [\]。 {ip: パブリックIPアドレス、
tm: 起動時間} '--filters '名前=タグ:名前、値=
MyInstanceName' | jq 'sort\ _by (.tm) | reverse |.\ [0\] '* フィルター。

2。 ラムダは、AWS CLI で次のコマンドを実行することで機能します
ターミナル「*awsラムダリスト関数 *」をクリックし、最後のものを検証します
「| *grep「LastModified*」フィルターを使用して時間を変更しました。

6。 アカウントに関するAWS からのセキュリティ通知を確認するには
[AWS サポート] にサインイン
センター] (https://support.console.aws.amazon.com/support/home#/) では
メッセージを読んで返信します。

7。 次の手順に従って、調査結果を確認してください。

1。 [IAM コンソール] (https://console.aws.amazon.com/iam/) を開きます。

2。 アクセスの下の左の列から「*アクセスアナライザー」*を選択します
レポート。

3。 「*アクティブな調査結果」*の下で、調査結果を確認してリソースを特定してください
S3 バケット、IAM ロール、ラムダなど、あなたの組織で
外部エンティティと共有される機能。

## 分析

疑わしいリソースや活動を特定したら
侵害を示したり、SIEMでさらに分析したり、ログに記録したりしてください
分析ツール。 AWS には、それを支援するさまざまなセキュリティサービスツールがあります
セキュリティイベントの分析。 これらのツールには以下が含まれます：

1。 **アマゾンガードデューティー**-アマゾンガードデューティーは脅威検出です
悪質な活動を継続的に監視するサービスと
AWS アカウント、アマゾン Elasticを保護するための不正な行動
コンピュートクラウド（EC2）ワークロード、コンテナアプリケーション、アマゾン Aurora
データベース、およびアマゾンシンプルストレージサービス（S3）に保存されているデータ。

2。 **AWSセキュリティハブ**-AWS セキュリティハブはクラウドセキュリティ体制です
自動的かつ継続的に実行する管理（CSPM）サービス
セキュリティのベストプラクティスは、お客様に役立つAWS リソースと照合します
設定ミスを特定し、セキュリティアラートを集約します
より簡単にできるように、標準化された形式の（つまり、調査結果）
それらを強化し、調査し、修正してください。

3。 **アマゾン探偵**-アマゾン探偵は分析を容易にします、
調査して、潜在的な根本原因を迅速に特定します
セキュリティ上の問題や不審な活動。

次の方法で、AWS クラウドトレイルのイベント履歴を検索することもできます
証拠を分析して収集するためのこれらのステップ：

1。 AWS クラウドトレイルのログを分析して、次のことを調べてください。

1。 ログインに関連した異常な活動：

1。 [クラウドトレイル] に移動してください
ダッシュボード] (https://console.aws.amazon.com/cloudtrail)。

2。 左側で、イベント履歴を選択します。

3。 ドロップダウンメニューで、[読み取り専用] を [イベント名] に変更します。

4。 以下の方法で、疑わしい活動がないかどうかを確認してください。
検索ボックスから次の用語を検索します。
「*コンソールログイン*」、「*役割を担う *」、「*フェデレーショントークンを取得*」、
「*認証情報レポートを取得 *」、「*認証情報レポートを生成 *」。 また
「*ユーザーアイデンティティ *」が表示されるはずだということに注意することが重要です
as「*type*」: ルートユーザーの場合は「*Root*」、「*type*」:
アカウントのすべてのローカルIAMユーザーを表す「*IAM User*」。

<!---->

1。 起動に使用したIAM アクセスキーIDとユーザー名を探してください
疑わしいアマゾン EC2 インスタンス：

1。 AWS クラウドトレイルコンソールを開き、「*イベント」を選択します
ナビゲーションペインから「履歴」*。

2。 「*検索属性」*ドロップダウンメニューを選択し、
「*リソース名」*を選択してください。

3。 [リソース名を入力] フィールドに、EC2インスタンスIDを貼り付けます。
次に、デバイスでEnterキーを押します。

4。 *インスタンスを実行 *のイベント名を拡張してください。

5。 AWS Sアクセスキーをコピーし、ユーザー名をメモしてください。

2。 AWS クラウドトレイルのイベント履歴を確認して、によるアクティビティを確認してください
侵害されたアクセスキー:

1。 クラウドトレイルコンソールを開き、「*イベント」を選択します
> 履歴」* をナビゲーションペインから。

2。 「*検索属性」*ドロップダウンメニューを選択し、
>「*AWS アクセスキー」を選択してください*。

3。 「*AWS Sアクセスキーフィールドを入力してください」*に、
> IAM アクセスキーIDが侵害されました。

4。 API呼び出し*インスタンスを実行 *のイベント名を拡張してください。

3。 サードパーティのIDプロバイダーを経由してAWS にアクセスする場合は、
必ずアクセスログを監査し、ベンダーのガイダンスに従ってください
イベントへの対応と環境の保護について。

<!---->

1。 IAM Access Advisorの侵害された認証情報を分析してください
最後にアクセスしたサービスを確認するための情報
これらのステップ：

1。 [IAM コンソール] (https://console.aws.amazon.com/iam) にアクセスしてください。

2。 [ユーザー] または [ロール] に移動し、侵害者の名前をクリックします
校長、「*アクセスアドバイザー」*タブを選択して、どれを見てください
最後にアクセスしたリソース。

## 封じ込め

侵害者についてより多くの情報を分析して収集した後
資格情報やその他の影響を受けるリソースについては、今こそ管理する時です
セキュリティイベントを抑制します。

1。 IAM ユーザーを無効にし、バックアップのIAM アクセスキーを作成して、
次の手順に従って、侵害されたアクセスキーを無効にします。

1。 [IAM コンソール] (https://console.aws.amazon.com/iam/) を開き、
IAM アクセスキーIDをIAM 検索バーに貼り付けます。

2。 ユーザー名を選択し、次に「*Security」を選択します
資格情報*」タブ。

3。 コンソールのパスワードフィールドで、「*Manage*」を選択します。

4。 コンソールアクセスで、「*無効*」を選択し、「適用」を選択します。

5。 侵害されたIAM アクセスキーには、「*非アクティブにする*」を選択してください。

2。 次の手順に従ってアクセスキーをローテーションしてください。

1。 まず、[IAM] にアクセスして2つ目のキーを作成します
コンソール] (https://console.aws.amazon.com/iam/)。

2。 ナビゲーションペインで、「*Users」*を選択します。

3。 目的のユーザーの名前を選択してから、
「*セキュリティ証明書」*タブ。

4。 「*アクセスキー」*セクションで、「*アクセスキーを作成」*を選択します。 オン
「*アクセスキーのベストプラクティス*と代替案」*ページ、
「*その他」*を選択し、次に「*次へ」を選択します。 。 *

5。 次に、新しいキーを使用するようにアプリケーションを変更してください。

6。 最初のキーを無効にします（ただし、削除しないでください）。

7。 申請に問題がある場合は、再度有効にしてください
キーを一時的に押します。 アプリケーションが完全に機能し、
最初のキーは無効になっています。そうして初めて安全に削除できます
最初のキー。 削除されたすべてのアクセスを記録してください
AWS クラウドトレイルのログでそれらを検索し続けるためのキーです。

3。 次の手順に従って、IAM ロールのアクティブなセッションを取り消します。

1。 [IAM コンソール] (https://console.aws.amazon.com/iam/) を開き、
ロールに移動し、アクティブにしたいIAM ロールをクリックします
のセッション

2。 IAM ロール名をクリックして、「*セッションを取り消す」*タブに移動します。

3。 「*アクティブなセッションを取り消す*」ボタンをクリックして、手順を確定します。

4。 次の手順に従って、影響を受けるリソースを隔離してください。

1。 アマゾン EC2 インスタンスの場合は、EC2インスタンスコンソールに行き、確認してください
隔離したいEC2インスタンスの横にあるボックスをクリックしてください
*アクション*、*セキュリティ*をクリックし、次に*セキュリティの変更をクリックします
グループ*。 現在のセキュリティグループをすべて切り離して、添付してください
インバウンドとアウトバウンドをブロックする隔離されたセキュリティグループ
EC2との通信。

2。 アマゾン S3 バケットの場合は、[bucket] を使用してください。
ポリシー] (https://docs.aws.amazon.com/AmazonS3/latest/userguide/add-bucket-policy.html)
疑わしいIPアドレスがS3 にアクセスするのをブロックします
バケツ。

5。 ID センターのセッションを取り消す:

IDセンターでは、気になるセッションが2つあります。
アクセスポータルセッションとロール/アプリケーションセッションはどれですか：

1。 アクセスポータルセッション：

1。 IDセンターでユーザーを無効にします。

1。 Identity Center コンソールに移動し、「ユーザー」を選択します。

2。 無効にするユーザーのユーザー名を選択してください

3。 ユーザーの「一般情報」ボックスで、「無効にする」をクリックします
> ユーザーアクセス'

2。 アクティブなセッションをすべて取り消します。

1。 Identity Centerのユーザーページで、「アクティブ」を選択します。
>「セッション」タブ

2。 リストされているセッションを選択し、[セッションを削除] をクリックします

2。 ロールセッションを取り消す:

1。 ユーザーが使用している権限セットを特定してください。

1。 Identity Center コンソールから、「権限セット」をクリックします

2。 権限セットの名前を選択してください。

3。 [インラインポリシー] までスクロールして、[編集] ボタンをクリックします

4。 次のポリシーを追加してください。

{

「バージョン」:「2012-10-17"、

「声明」:\ [

{

「効果」:「拒否」、

「アクション」:「\ *」、

「リソース」:「\ *」、

「条件」: {

「等しい文字列」: {

「アイデンティティストア:ユーザーID」:「例」

}、

「日付未満」: {

「AWS: トークンの発行時間」:「2023-09-26T 15:00:00.000 Z」

}

}

}

\]

}

このポリシーでは、「example」をユーザーの ID センターのユーザー ID に更新してください。
ユーザーIDは、ユーザーの「一般情報」ボックスにあります。
ユーザーページ。 aws: tokenIssueTimeの値は、入力時間と等しくなければなりません
このポリシーを適用します。

1。 アプリケーションセッション

アプリケーションセッションは、ユーザーがサードパーティにアクセスしたときに作成されます
アプリケーションまたはAWS サービスをアクセスポータルから直接入手してください。

アプリケーションセッションを取り消すには、のドキュメントを確認してください
アクセスされたアプリケーション。

1。 侵害されたIDセンター

IDプロバイダーが危険にさらされている場合は、アクセスをブロックする必要があります
侵害されたIDプロバイダー（外部など）のIDセンター
SAMLベースのアイデンティティプロバイダー（またはActive Directory）を変更することにより
アイデンティティ・ソースを「アイデンティティ・ソース・ディレクトリ」へ。

アイデンティティソースを変更するには：

6.1 アイデンティティセンターのコンソールに移動します

6.2「設定」を選択してください

6.3 設定ページで、「アイデンティティソース」タブをクリックします

6.4「アクション」ボタンをクリックし、「IDを変更」を選択します
ソース

6.5 [アイデンティティソースの選択] で [アイデンティティセンターディレクトリ] を選択します
ページ

6.6「次へ」ボタンをクリックしてください

6.7「確認して確認」ボックスに表示されている情報を読んでください。

6.8 該当するフィールドに「ACCEPT」と入力し、「変更」をクリックします
「ID ソース」ボタン

注意、サードパーティのIDプロバイダーを経由してAWS にアクセスしている場合、
必ずアクセスログを監査し、ベンダーのガイダンスに従ってください
イベントに対応し、環境を保護します。

また、Active Directoryからアイデンティティセンターに変更する場合
ディレクトリでは、すべてのユーザーとグループが削除されます。 権限セットは
は削除されませんが、権限セットの割り当ては削除されます。 もし、あなたが
外部のSAMLベースのIDプロバイダー、すべてのユーザーから変更しています
およびグループは、Identity Centerに入力されたままになります
権限セットの割り当て

## 根絶

セキュリティイベントの封じ込めが完了したら、作業に取り掛かります。
セキュリティイベントの原因の除去とクリーニングについて。

1。 侵害されたキーによって作成された、次のようなリソースをすべて削除します
「分析フェーズステップ1」で検出されました。 すべてのAWS リージョンをチェックしてください。
AWS リソースを起動しない地域。 必要なら
調査のためのリソースを保管し、それらをバックアップすることを検討してください。

2。 と、をチェックしてください
[削除] (https://repost.aws/knowledge-center/terminate-resources-account-closure)
アカウント内で実行されている、認識できないすべてのサービス。 支払う
次のリソースに特に注意してください。

1。 EC2インスタンスとAMI（停止中のインスタンスを含む）
州。

2。 EBS ボリュームとスナップショット。

3。 AWS ラムダ関数とレイヤー。

3。 S3 バケットまたはログのロギングから不要な権限を削除してください
「検出フェーズのステップ6」で特定された集計リソースは
検出を回避するために使用できます。 これにより、意図しないものを識別できます
あなたのリソースとデータへのアクセス。

4。 操作に必要のない公開データをすべて削除してください。

5。 一般公開されているユーザーを対象にセキュリティ脆弱性スキャンを実施してください
リソース。 [アマゾン] のようなツールを使うことができます
インスペクター] (https://docs.aws.amazon.com/inspector/latest/user/scanning-resources.html)
<sup>OSとサードパーティのソフトウェアアプリケーションをスキャンします</sup>
脆弱性。

## 回復

セキュリティイベントの原因を根絶したら。 その時です
影響を受けたリソースを正常な状態に戻すためです。

1。 以前の既知のクリーンバックアップから必要なデータを復元します
イベント:

1。 [アマゾン EBS スナップショットからの復元、または
AMI] (https://docs.aws.amazon.com/prescriptive-guidance/latest/backup-recovery/restore.html)。

2。 [DBからの復元]
スナップショット] (https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_RestoreFromSnapshot.html) アマゾン
RDS。

3。 [以前のものを復元する
バージョン] (https://docs.aws.amazon.com/AmazonS3/latest/userguide/RestoringPreviousVersions.html) アマゾン
S3 オブジェクトバージョン。

2。 必要に応じて、再デプロイを含め、システムをゼロから再構築してください
自動化を使用して信頼できるソースから、時には新しいAWS アカウントで。

3。 多要素認証「MFA」へのアクセスが失われたのに、あなたができなければ
ルートアカウントに別のMFAデバイスを登録してください。
次の手順に従ってください。

1。 [AWS マネジメントにサインイン]
コンソール] (https://console.aws.amazon.com/) をアカウントオーナーとして
ルートユーザーを選択し、AWS アカウントのメールアドレスを入力してください
住所。 次のページで、パスワードを入力します。

2。 「追加の確認が必要です」ページで、MFAを選択します
認証方法を選択し、[次へ] を選択します。

3。 使用しているMFAの種類によっては、
別のページですが、「*多要素認証のトラブルシューティング」*オプションは機能します
同じです。 「*追加の確認が必要です」*ページに
または「*多要素認証」*ページで、「*トラブルシューティング
MFA」*。

4。 必要に応じて、パスワードをもう一度入力して、*Sign in*を選択してください。

5。 「*認証デバイスのトラブルシューティング」*ページの
「*の代替要素を使用してサインインしてください
認証」* セクションで、「*代替手段を使ってサインイン」を選択します
要因」*。

6。 の「*代替要素を使用してサインイン」について
認証」* ページ、確認してアカウントを認証してください
メールアドレスは、「*確認メールを送信」を選択してください*

7。 AWS アカウントに関連付けられているメールをチェックしてください
アマゾンウェブサービスからのメッセージ
(recover-mfa-no-reply@verify.signin.aws)。 指示に従ってください
メールに。

> アカウントにメールが表示されない場合は、迷惑メールフォルダを確認するか、
> ブラウザに戻り、「*メールを再送信*」を選択します。

1。 メールアドレスを確認したら、認証を続けることができます
あなたのアカウント。 主連絡先の電話番号を確認するには、
「今すぐ電話して」を選択します。

2。 AWS からの電話に応答し、プロンプトが表示されたら、6桁を入力します
電話のキーパッドにあるAWS ウェブサイトの番号。

> AWS から電話がかかってこない場合は、[サインイン] を選択してサインインしてください
> コンソールをもう一度実行して、最初からやり直してください。 または、[紛失または使用不能のマルチファクター] を参照してください。
> 認証（MFA）
> デバイス] (https://support.aws.amazon.com/#/contacts/aws-mfa-support) へ
> サポートに連絡してください。

1。 電話番号を確認したら、アカウントにサインインできます
> コンソールに [サインイン] を選択します。

2。 次のステップは、使用しているMFAの種類によって異なります。

1。 仮想 MFA デバイスの場合は、デバイスからアカウントを削除します。
> 次に [AWS セキュリティ] に移動してください
> 資格情報] (https://console.aws.amazon.com/iam/home? #security_credential) ページ
> そして、作成する前に古いMFA仮想デバイスエンティティを削除してください
> 新しいもの。

2。 FIDOのセキュリティキーについては、[AWS セキュリティ] にアクセスしてください
> 資格情報] (https://console.aws.amazon.com/iam/home? #security_credential) ページ
> 新しいFIDOセキュリティキーを有効にする前に、古いFIDOセキュリティキーを無効化してください
> 一。

3。 ハードウェアTOTPトークンについては、サードパーティのプロバイダーに問い合わせてください
> デバイスの修理や交換を手伝ってください。 続けて署名できます
>代替の認証要素を使用するまで
> 新しいデバイスを受け取ってください。 新しいハードウェアMFAを入手したら
> デバイスは、[AWS セキュリティ] に移動してください
> 資格情報] (https://console.aws.amazon.com/iam/home? #security_credential) ページ
> そして、あなたの前の古いMFAハードウェアデバイスエンティティを削除してください
> 新しいものを作成してください。

<!---->

1。 IAM プリンシパルに適切なアクセス権と権限があることを確認してください
セキュリティイベントの後。

2。 [AWS] を使用して脆弱性に対処し、必要なパッチをインストールしてください
SSM パッチ
マネージャー] (https://docs.aws.amazon.com/systems-manager/latest/userguide/patch-manager.html)
<sup>またはあなたが使用している他のサードパーティのツール</sup>。

3。 侵害されたり損傷したりしたファイルは、以下のクリーンバージョンに置き換えてください
バックアップ。

## インシデント後のアクティビティ

セキュリティインシデントからの回復に成功すると、
[* AWS セキュリティインシデント] で説明されている演習を実施する必要があります
対応ガイド、インシデント後
アクティビティ*] (https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/establish-framework-for-learning.html)。
これは、インシデントから学んだ教訓を文書化し、測定するのに役立ちます
インシデント対応能力の有効性を向上させてください。
そして、同様のインシデントを防ぐための追加の管理を実施してください
定期的。

## 結論

このプレイブックでは、次のような場合に最初に取るべきステップについて説明しました
資格情報のセキュリティ侵害イベントがAWS アカウント内で発生します。
これには、AWS サポートへの連携、侵害の検出、分析が含まれます
セキュリティイベントを含む、アカウント内のイベント
脅威を根絶し、アカウントを「既知の良好」に回復します
運用状況、および授業を含むインシデント後の活動
学んだ。 次のステップとして、以下のAWS リソースを確認してください。
インシデント対応能力の向上に役立ちます：

1。 [AWS セキュリティインシデントレスポンス]
ガイド] (https://docs.aws.amazon.com/whitepapers/latest/aws-security-incident-response-guide/aws-security-incident-response-guide.html)

2。 [侵害されたIAM のためのAWS カスタマープレイブックフレームワーク
認証情報] (https://github.com/aws-samples/aws-customer-playbook-framework/blob/main/docs/Compromised_IAM_Credentials.md)

3。 [の AWS セキュリティのベストプラクティス]
IAM] (https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)

4。 [AWS よく設計されたフレームワーク — セキュリティ
ピラー] (https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html)

## 付録 A — ログの確認

**クラウドトレイルのログ構造**

クラウドトレイルのログを検索するときは、理解することが重要です
クラウドトレイルイベントレコードに含まれるさまざまなフィールド。 のためには
全リストは、[<u>公式クラウドトレイル] を参照してください
ドキュメンテーション</u>] (https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html)。

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>フィールド</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>イベントタイム</td>
<td>リクエストが完了した日付と時刻、調整済み
世界時（UTC）</td>。
</tr>
<tr class="even">
<td>イベント名</td>
<td>要求されたアクション、これはAPIのアクションの1つです
そのサービス</td>
</tr>
<tr class="odd">
<td>イベントソース</td>
<td>リクエストが行われたサービス。 この名前は通常
スペースを含まないサービス名の短縮形に.amazonaws.com を加えたものです</td>。
</tr>
<tr class="even">
<td>ユーザーアイデンティティ</td>
<td>リクエストをしたIAM IDに関する情報。 詳細については
情報、<aを参照してください
<u>href=」https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-user-identity.html「> クラウドトレイル
ユーザーアイデンティティ要素</u></a></td>。
</tr>
<tr class="odd">
<td>リソース</td>
<td><p>イベントでアクセスされたリソースのリスト。 フィールドには以下を含めることができます
次の情報：</p>
<ul>
<li><p>リソース ARN</p></li>
<li><p>リソース所有者のアカウントID</p></li>
<li><p>次の形式のリソースタイプ識別子：
AWS:: aws-サービス名:: データ型名</p></li>
</ul></td>
</tr>
<tr class="even">
<td>AWS リージョン</td>
<td>リクエストが行われたAWS リージョン（us-east-2など）</td>
</tr>
<tr class="odd">
<td>送信元IPアドレス</td>
<td>リクエストが行われたIPアドレス。 そのような行動について
はサービスコンソールから送信され、報告される住所は
コンソールのWebサーバーではなく、基盤となる顧客リソースです。</td>
</tr>
</tbody>
</table>

**イベント**

脅威アクターはその後に実行するアクションはいくつかあります
アカウント認証情報の漏えい。 すべてをリストするのは現実的ではありませんが
考えられるアクション、あなたの行動中に検索すべきいくつかのパターンを紹介します
調査。

**注意:** 以下のAPIアクションは、必ずしもセキュリティを示すものではありません
インシデントが発生しました。 コンテキスト内で記録されたすべてのアクティビティを評価してください
あなたの調査の。

**SAML/OIDC ID プロバイダ設定の変更**

脅威アクターは、SAML/OIDC IDプロバイダーを作成または変更する可能性があります
検出されないようにし、社内での永続性を維持するための設定
クラウド環境。

<table>
<colgroup>
<col style="width: 32%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>API アクション</strong></th>
<th><strong>説明</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>私は：SAMLプロバイダーの作成</td>
<td>IDプロバイダー（IdP）を説明するIAMリソースを作成します
それはSAML 2.0をサポートしています</td>
</tr>
<tr class="even">
<td>私は:SAMLプロバイダーを削除する</td>
<td>IAM のSAMLプロバイダーリソースを削除します。</td>
</tr>
<tr class="odd">
<td>私は：SAMLプロバイダーの更新</td>
<td>既存のSAMLプロバイダーのメタデータドキュメントを更新します</td>
</tr>
<tr class="even">
<td>私は：OpenID接続プロバイダを作成しています</td>
<td>アイデンティティプロバイダー（IdP）を説明するIAMエンティティを作成します
OpenIDコネクト（OIDC）をサポートします</td>。
</tr>
<tr class="odd">
<td>私は：OpenID接続プロバイダーにクライアントIDを追加します</td>
<td>新しいクライアントID（オーディエンスとも呼ばれます）をクライアントのリストに追加します
IDは指定されたIAM OpenID接続（OIDC）にすでに登録されています
プロバイダーリソース</td>
</tr>
<tr class="even">
<td>私は:OpenID接続プロバイダを削除します</td>
<td>内のOpenID Connect IDプロバイダー（IdP）リソースオブジェクトを削除します
IAM</td>
</tr>
<tr class="odd">
<td>私は：OpenIDConnectプロバイダからクライアントIDを削除してください</td>
<td>指定されたクライアントID（オーディエンスとも呼ばれます）をから削除します
指定されたIAM OpenID Connectに登録されているクライアントIDのリスト
(OIDC) プロバイダーリソースオブジェクト</td>
</tr>
<tr class="even">
<td>私は：OpenID接続プロバイダのサムプリントを更新してください</td>
<td>サーバー証明書のサムプリントの既存のリストを置き換えます
OpenID Connect（OIDC）プロバイダーリソースオブジェクトに関連付けられています
指紋の新しいリスト</td>
</tr>
</tbody>
</table>

**IAM 設定の変更**

脅威アクターは、IAM プリンシパル、認証情報、またはそれらを作成または変更する可能性があります
検出を回避したり、クラウド内で永続性を維持したりするための権限
環境。

<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="header">
<th>API アクション</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>私は:パスワードを変更</td>
<td>これを呼び出しているIAM ユーザーのパスワードを変更します
オペレーション</td>
</tr>
<tr class="even">
<td>私は:ユーザーを作成</td>
<td>AWS アカウントの新しいIAM ユーザーを作成します</td>
</tr>
<tr class="odd">
<td>私は：ロールを作成しています</td>
<td>AWS アカウントに新しいロールを作成します</td>
</tr>
<tr class="even">
<td>私は:グループを作成</td>
<td>新しいグループを作成します</td>
</tr>
<tr class="odd">
<td>私は：ユーザーポリシーを添付してください</td>
<td>指定された管理ポリシーを指定のユーザーにアタッチします</td>
</tr>
<tr class="even">
<td>私は：ロールポリシーを添付します</td>
<td>指定された管理ポリシーを指定されたIAM ロールにアタッチします</td>
</tr>
<tr class="odd">
<td>私は：グループポリシーを添付してください</td>
<td>指定された管理ポリシーを指定されたIAM にアタッチします
</td>グループ
</tr>
<tr class="even">
<td>iam: アクセスキーを一覧表示する</td>
<td>に関連付けられているアクセスキーIDに関する情報を返します
指定IAM ユーザー</td>
</tr>
<tr class="odd">
<td>私は:ポリシーバージョンを作成</td>
<td>指定された管理ポリシーの新しいバージョンを作成します</td>
</tr>
<tr class="even">
<td>iam: ログインプロファイルの更新</td>
<td>指定されたIAM ユーザーのパスワードを変更します</td>
</tr>
<tr class="odd">
<td>私は:アクセスキーを作成</td>
<td>新しいAWS シークレットアクセスキーと対応するAWS アクセスキーを作成します
指定されたユーザーのID</td>
</tr>
<tr class="even">
<td>iam: アクセスキーを更新</td>
<td>指定されたアクセスキーのステータスをアクティブからに変更します
非アクティブ、またはその逆</td>。
</tr>
<tr class="odd">
<td>私は:MFA デバイスを無効にします</td>
<td>指定した MFA デバイスを非アクティブ化し、関連付けから削除します
で最初に有効になっていたユーザー名で</td>
</tr>
</tbody>
</table>

**ロギングとモニタリングの設定の変更**

脅威アクターは、回避するためにリソース監視を無効にしたり、ログを削除したりすることがあります
インシデント調査の検出または抑止。

<table>
<colgroup>
<col style="width: 46%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="header">
<th>クラウドトレイル:トレイルを削除</th>
<th>証跡を削除します — クラウドトレイルイベントのへの配信を無効にします
アマゾン S3 バケット、クラウドウォッチ Logs、またはアマゾンイベントブリッジ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>クラウドトレイル:ロギングを停止</td>
<td>AWS API呼び出しの記録とログファイルの配信を一時停止します
指定されたトレイル</td>
</tr>
<tr class="even">
<td>クラウドトレイル:トレイルを更新</td>
<td>ログファイルの配信を指定する設定を更新します</td>
</tr>
<tr class="odd">
<td>CloudTrail: イベントデータストアを削除する</td>
<td><a を削除します
<u>href=」https://docs.aws.amazon.com/awscloudtrail/latest/userguide/query-event-data-store.html「> クラウドトレイル
レイク・イベント・デイト・ストア</u></a></td>
</tr>
<tr class="even">
<td>警備義務:検出器を削除</td>
<td>アマゾンガードデューティディテクターを削除し、のガードデューティを無効にします
特定の地域</td>
</tr>
<tr class="odd">
<td>ガードデューティ：公開先の削除</td>
<td>調査結果がエクスポートされる公開先を削除します
</td>に
</tr>
<tr class="even">
<td>アクセスアナライザー:削除アナライザー</td>
<td>指定されたアナライザーを削除し、IAM アクセスアナライザーを無効にします
その地域向けのサービス。</td>
</tr>
<tr class="odd">
<td>設定:設定ルールを削除</td>
<td>指定した AWS コンフィグルールとその評価をすべて削除します
</td>結果
</tr>
<tr class="even">
<td>config: 設定レコーダーの削除</td>
<td>AWS Config設定レコーダーを削除します</td>
</tr>
<tr class="odd">
<td>config: 配信チャネルを削除</td>
<td>AWS コンフィグの配信チャネルを削除します</td>
</tr>
<tr class="even">
<td>設定:設定レコーダーを停止します</td>
<td>の構成と構成変更の記録を停止します
指定されたレコーディンググループ</td>
</tr>
</tbody>
</table>

**S3 バケット設定の変更**

脅威アクターは、以下の目的でS3 バケットの設定を変更または削除することがあります。
データを盗み出してください。

<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th>S3: バケットを一覧表示する</th>
<th>の認証された送信者が所有するすべてのバケットのリストを返します
リクエスト</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>S3: バケットを作成</td>
<td>新しいバケットを作成します</td>
</tr>
<tr class="even">
<td>S3: バケットパブリックアクセスブロックを削除する</td>
<td>アマゾン S3 パブリックアクセスブロック設定を削除します
バケツ</td>
</tr>
<tr class="odd">
<td>S3: プットバケットポリシー</td>
<td>バケットのポリシーを追加または更新します</td>
</tr>
<tr class="even">
<td>S3: バケットポリシーの削除</td>
<td>ポリシーをバケットから削除します</td>
</tr>
<tr class="odd">
<td>S3: プットオブジェクト ACL る</td>
<td>内のオブジェクトのアクセス制御リスト（ACL）権限を設定します
アマゾン S3 バケット</td>
</tr>
<tr class="even">
<td>S3: オブジェクト ACL を削除</td>
<td>オブジェクトのアクセス制御リスト (ACL) を削除します</td>
</tr>
<tr class="odd">
<td>S3: バケットコードを入れて</td>
<td>バケットのCORS設定を設定します</td>
</tr>
<tr class="even">
<td>S3: バケットCORを削除する</td>
<td>バケットに設定されたCORS設定情報を削除します</td>
</tr>
<tr class="odd">
<td>S3: PUT バケット暗号化</td>
<td>のデフォルトの暗号化とアマゾン S3 バケットキーを設定します
既存のバケット</td>
</tr>
<tr class="even">
<td>S3: バケット暗号化の削除する</td>
<td>バケットのデフォルトの暗号化をサーバー側にリセットします
アマゾン S3 マネージドキーによる暗号化（SSE-S3</td>）
</tr>
</tbody>
</table>

**その他のアクション**

滞在中に強調すべき他のアクションをいくつか紹介します
調査

<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th>KMS: ディセーブルキー</th>
<th>KMS キーの状態を無効に設定します。 この変更は一時的にです
暗号化操作にKMS キーを使用することを防ぎます</th>。
</tr>
</thead>
<tbody>
<tr class="odd">
<td>KMS: スケジュールキーの削除</td>
<td>KMS キーの削除をスケジュールします。</td>
</tr>
<tr class="even">
<td>KMS: プットキーポリシー</td>
<td>指定した KMS キーにキーポリシーをアタッチします。 主な方針は
KMS キーへのアクセスを制御する主な方法です</td>。
</tr>
<tr class="odd">
<td>KMS: キーを作成</td>
<td>AWS アカウントに顧客管理の一意のKMS キーを作成し、
地域。</td>
</tr>
<tr class="even">
<td>ec2: インスタンスを説明してください</td>
<td>アカウント内のEC2インスタンスについて説明します。</td>
</tr>
<tr class="odd">
<td>ec2: インスタンスを実行する</td>
<td>アカウント内でEC2インスタンスを起動します。</td>
</tr>
<tr class="even">
<td>EC2: VPC を作成してください</td>
<td>アカウント内に VPC を作成します。</td>
</tr>
<tr class="odd">
<td>EC2: VPC について説明してください</td>
<td>アカウント内のVPCについて説明します。</td>
</tr>
<tr class="even">
<td>EC2: セキュリティグループの作成</td>
<td>セキュリティグループを作成します。 セキュリティグループは仮想グループとして機能します
インバウンドとアウトバウンドのトラフィックを制御するためのインスタンスのファイアウォール</td>。
</tr>
<tr class="odd">
<td>EC2: セキュリティグループの削除</td>
<td>セキュリティグループを削除します。</td>
</tr>
<tr class="even">
<td>RDS: 作成された DB インスタンス</td>
<td>RDS データベースインスタンスを作成します。</td>
</tr>
<tr class="odd">
<td>RDS: 削除された DB インスタンス</td>
<td>RDS データベースインスタンスを削除します。</td>
</tr>
</tbody>
</table>